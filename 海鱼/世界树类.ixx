// 世界树模块.ixx
export module 世界树模块;

import 主信息定义模块;
import 宇宙链模块;

export class 世界树类 {
public:
    using 节点类型 = 基础信息节点类;

private:
    场景节点类* 根场景 = nullptr;  // 现实世界根场景（在 宇宙链 上的一棵子树）

public:
    世界树类() = default;
    ~世界树类() = default;

    世界树类(const 世界树类&) = delete;
    世界树类& operator=(const 世界树类&) = delete;
    世界树类(世界树类&&) = default;
    世界树类& operator=(世界树类&&) = default;

    // 初始化默认世界：在 宇宙链.根指针 下新建一个“根场景”
    void 初始化默认世界() {
        根场景 = nullptr;

        auto* 主信息 = new 场景节点主信息类();  // 名称、世界层级等你在定义里补
        基础信息基类* 基类指针 = 主信息;

        根场景 = static_cast<场景节点类*>(
            宇宙链.添加子节点(宇宙链.根指针, 基类指针)
            );
        根场景->主键 = "世界_根场景";
    }

    场景节点类* 获取根场景() const { return 根场景; }

    // 在某个场景下新建一个“存在实例”
    存在节点类* 新建存在(场景节点类* 所在场景,
        存在节点主信息类* 主信息) {
        if (!根场景) {
            初始化默认世界();
        }
        if (!所在场景) {
            所在场景 = 根场景;
        }
        if (!主信息) {
            主信息 = new 存在节点主信息类();
        }

        基础信息基类* 基类指针 = 主信息;
        auto* 节点 = static_cast<存在节点类*>(
            宇宙链.添加子节点(所在场景, 基类指针)
            );
        return 节点;
    }

    // 给某个存在实例挂一个特征（颜色、形状、位置等）
    特征节点类* 为存在添加特征(存在节点类* 存在,
        特征节点主信息类* 特征主信息) {
        if (!存在 || !特征主信息) return nullptr;

        基础信息基类* 基类指针 = 特征主信息;
        auto* 节点 = static_cast<特征节点类*>(
            宇宙链.添加子节点(存在, 基类指针)
            );
        return 节点;
    }
};
